<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>次こそ九蓮宝燈 -極-</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --bg-green: #1a4a1a; --tile-white: linear-gradient(145deg, #ffffff, #e6e6e6); }
        body { margin: 0; background: radial-gradient(circle, #2a5a2a 0%, #0a2a0a 100%); color: #fff; font-family: "Hiragino Mincho ProN", serif; overflow: hidden; }
        #game-ui { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 20px; box-sizing: border-box; }

        /* リアルな麻雀牌 */
        .tile {
            width: 45px; height: 65px; background: var(--tile-white); border-radius: 4px;
            box-shadow: 0 4px 0 #bbb, 0 6px 10px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: bold; color: #0044ff; position: relative;
        }
        .tile::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: linear-gradient(white, rgba(255,255,255,0)); border-radius: 4px 4px 0 0; opacity: 0.5; }

        /* メッセージ演出 */
        #main-msg { font-size: 2.2rem; text-align: center; font-weight: bold; text-shadow: 0 0 15px #ff0000; min-height: 80px; }
        .sub-msg { font-size: 1.2rem; color: #ffd700; margin-top: 10px; opacity: 0; }

        /* ボタン */
        .btn-pachinko {
            padding: 15px 60px; font-size: 1.8rem; border-radius: 50px; border: 4px solid #ffd700;
            background: linear-gradient(to bottom, #ff4444, #880000); color: white;
            box-shadow: 0 0 20px rgba(255,0,0,0.6), inset 0 0 10px rgba(255,255,255,0.5);
            cursor: pointer; transition: transform 0.1s;
        }
        .btn-pachinko:active { transform: scale(0.95); }

        /* カットイン演出 */
        #cut-in {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            z-index: 50; display: none; text-align: center;
        }
        .big-tile { width: 150px; height: 210px; font-size: 6rem; border-radius: 12px; box-shadow: 0 0 50px rgba(255,255,0,0.8); }

        /* スロット */
        #slot-section { display: none; text-align: center; }
        .slot-display { display: flex; gap: 15px; margin: 30px 0; }
        .spinning { animation: blur-spin 0.05s infinite; }
        @keyframes blur-spin { 0% { filter: blur(0px); transform: translateY(-2px); } 100% { filter: blur(4px); transform: translateY(2px); } }

        /* 九蓮演出 */
        #rainbow-flash { position: fixed; inset: 0; display: none; pointer-events: none; z-index: 100; animation: rainbow 0.2s infinite; opacity: 0.3; }
        @keyframes rainbow { 0% { background: red; } 20% { background: yellow; } 40% { background: green; } 60% { background: cyan; } 80% { background: blue; } 100% { background: magenta; } }
    </style>
</head>
<body>

<div id="game-ui">
    <div id="main-msg">次こそ九蓮宝燈</div>
    
    <div id="hand-display" style="display: flex; gap: 4px;"></div>

    <div id="action-area">
        <button id="start-btn" class="btn-pachinko" onclick="runScenario()">打 つ</button>
    </div>

    <div id="slot-section">
        <div class="slot-display">
            <div class="tile big-tile">④</div>
            <div id="spin-tile" class="tile big-tile spinning">?</div>
            <div class="tile big-tile">⑤</div>
        </div>
        <p>連打しろ！！！</p>
        <button class="btn-pachinko" onclick="handleTsumo()">ツモ！！</button>
    </div>
</div>

<div id="cut-in">
    <div id="cut-in-label" style="font-size: 2rem; color: yellow; margin-bottom: 10px;">東家：ツモ</div>
    <div id="cut-in-tile" class="tile big-tile">⑥</div>
</div>

<div id="rainbow-flash"></div>

<script>
    const hand = ["①","①","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑨","⑨"];
    const msg = document.getElementById('main-msg');
    const handDiv = document.getElementById('hand-display');
    const cutIn = document.getElementById('cut-in');

    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }

    async function runScenario() {
        document.getElementById('start-btn').style.display = 'none';
        
        // 配牌
        for(let t of hand) {
            const div = document.createElement('div');
            div.className = 'tile'; div.innerText = t;
            handDiv.appendChild(div);
            await wait(100);
        }

        await wait(1500);
        msg.innerText = "北家：リーチ..."; vibrate(50);
        await wait(1500);
        msg.innerText = "東家：リーチ..."; vibrate(50);
        await wait(2000);
        
        msg.style.color = "#ffff00";
        msg.innerText = "激 熱";
        gsap.fromTo(msg, {scale: 0.5}, {scale: 1.5, duration: 0.5, ease: "back.out"});
        vibrate([100, 50, 100]);
        await wait(1000);

        msg.style.color = "#ff0000";
        msg.innerText = "九蓮宝燈聴牌！！";
        vibrate(300);
        await wait(2000);

        msg.style.color = "#fff";
        msg.innerText = "西家：ツモ切り..."; await wait(1200);
        msg.innerText = "北家：ツモ切り..."; await wait(1200);
        msg.innerText = "東家のツモ番..."; await wait(2000);

        const isLucky = Math.random() < 0.1;

        if (!isLucky) {
            // 東家ツモ演出
            cutIn.style.display = 'block';
            gsap.to(cutIn, {scale: 1, duration: 0.3, ease: "back.out"});
            vibrate([200, 100, 200]);
            msg.innerText = "東家：ツモ！！";
            await wait(2500);
            alert("東家「６ピン（キミのアガリ牌）、もらっていくよ」\n\n2000オール。終了。");
            location.reload();
        } else {
            // 自分チャンス
            msg.innerText = "奇跡のツモ番...！";
            document.getElementById('slot-section').style.display = 'block';
            vibrate(500);
        }
    }

    async function handleTsumo() {
        document.getElementById('slot-section').style.display = 'none';
        const spinTile = document.getElementById('spin-tile');
        spinTile.classList.remove('spinning');
        
        const sub = Math.random();
        if (sub < 0.989) {
            spinTile.innerText = "西";
            msg.innerText = "ハズレ。";
            await wait(1500);
            alert("西家：ロン。1000点。\n次こそ九蓮宝燈...！");
            location.reload();
        } else if (sub < 0.999) {
            spinTile.innerText = "③";
            msg.innerText = "ツモ！";
            await wait(1500);
            alert("清一色・平和。2000-4000。\n「そっちじゃないんだよなぁ...」");
            location.reload();
        } else {
            // 九蓮成就
            document.getElementById('rainbow-flash').style.display = 'block';
            spinTile.innerText = "⑥";
            msg.innerText = "九 蓮 宝 燈 ！！";
            vibrate([500, 100, 500, 100, 1000]);
            await wait(4000);
            alert("伝説の九蓮宝燈！おめでとう！！");
            location.reload();
        }
    }
</script>
</body>
</html>
