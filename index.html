<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¡ã“ãä¹è“®å®ç‡ˆ -æ¥µãƒªã‚¢ãƒ«-</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { 
            --tile-ivory: #fdfdf5;
            --tile-side: #e0e0d0;
            --table-green: radial-gradient(circle, #2d5a27 0%, #1a3a16 100%);
        }
        body { 
            margin: 0; background: var(--table-green); color: #fff; 
            font-family: "Hiragino Mincho ProN", serif; overflow: hidden; 
            touch-action: manipulation; 
        }
        #game-ui { 
            width: 100vw; height: 100vh; display: flex; flex-direction: column; 
            align-items: center; justify-content: space-around; padding: 20px; box-sizing: border-box; 
        }

        /* ãƒªã‚¢ãƒ«ä»•æ§˜ã®éº»é›€ç‰Œ */
        .tile {
            width: 46px; height: 64px; background: var(--tile-ivory); border-radius: 4px;
            /* ä¸‰å±¤æ§‹é€ ã§å½«ã‚Šã¨åšã¿ã‚’è¡¨ç¾ */
            box-shadow: 
                inset 0 2px 3px rgba(255,255,255,1), 
                0 3px 0 var(--tile-side), 
                0 5px 0 #999,
                0 8px 15px rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center;
            position: relative; transition: transform 0.1s;
        }
        /* ç‰Œã®è¡¨é¢ã®åå°„å…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .tile::before {
            content: ''; position: absolute; top: 1px; left: 1px; right: 1px; height: 35%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 100%);
            border-radius: 3px; pointer-events: none;
        }

        .tile-content {
            font-size: 2.2rem; font-weight: bold; 
            filter: drop-shadow(1px 1.5px 1px rgba(0,0,0,0.4)); /* å½«ã‚Šã®æ·±ã• */
        }
        /* ç­’å­ã®è‰²è¨­å®š */
        .pin-blue { color: #1e3a8a; }
        .pin-red { color: #be123c; } /* 1ç­’ç”¨ */
        .character-black { color: #111; }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¼”å‡º */
        #main-msg { font-size: 2.2rem; text-align: center; font-weight: bold; text-shadow: 0 0 15px #ff0000; min-height: 80px; line-height: 1.2; }

        /* ãƒœã‚¿ãƒ³ */
        .btn-pachinko {
            padding: 15px 60px; font-size: 1.8rem; border-radius: 50px; border: 4px solid #ffd700;
            background: linear-gradient(to bottom, #ff4444, #880000); color: white;
            box-shadow: 0 0 25px rgba(255,0,0,0.6), inset 0 0 15px rgba(255,255,255,0.4);
            cursor: pointer;
        }

        /* ã‚«ãƒƒãƒˆã‚¤ãƒ³ */
        #cut-in {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            z-index: 50; display: none; text-align: center;
        }
        .big-tile { width: 140px; height: 195px; border-radius: 10px; box-shadow: 0 0 60px rgba(255,255,0,0.9); }
        .big-tile .tile-content { font-size: 6.5rem; }

        /* ã‚¹ãƒ­ãƒƒãƒˆ */
        #slot-section { display: none; text-align: center; }
        .slot-display { display: flex; gap: 15px; margin: 30px 0; justify-content: center; }
        .spinning { animation: blur-spin 0.05s infinite; }
        @keyframes blur-spin { 0% { filter: blur(0px); transform: translateY(-2px); } 100% { filter: blur(4px); transform: translateY(2px); } }

        #rainbow-flash { position: fixed; inset: 0; display: none; pointer-events: none; z-index: 100; animation: rainbow 0.15s infinite; opacity: 0.4; }
        @keyframes rainbow { 0% { background: red; } 20% { background: yellow; } 40% { background: green; } 60% { background: cyan; } 80% { background: blue; } 100% { background: magenta; } }
    </style>
</head>
<body>

<div id="game-ui">
    <div id="main-msg">æ¬¡ã“ãä¹è“®å®ç‡ˆ</div>
    
    <div id="hand-display" style="display: flex; gap: 4px; flex-wrap: wrap; justify-content: center; width: 95%;"></div>

    <div id="action-area">
        <button id="start-btn" class="btn-pachinko" onclick="runScenario()">æ‰“ ã¤</button>
    </div>

    <div id="slot-section">
        <div class="slot-display">
            <div id="tile-4" class="tile big-tile"><span class="tile-content pin-blue">â‘£</span></div>
            <div id="spin-tile" class="tile big-tile spinning"><span class="tile-content character-black">?</span></div>
            <div id="tile-5" class="tile big-tile"><span class="tile-content pin-blue">â‘¤</span></div>
        </div>
        <p style="color:#ffd700; font-size: 1.5rem; font-weight:bold; text-shadow: 1px 1px #000;">é€£æ‰“ã—ã‚ï¼ï¼ï¼</p>
        <button class="btn-pachinko" onclick="handleTsumo()">ãƒ„ãƒ¢ï¼ï¼</button>
    </div>
</div>

<div id="cut-in">
    <div id="cut-in-label" style="font-size: 2.2rem; color: #ff0000; font-weight:bold; background: rgba(0,0,0,0.8); padding: 5px 20px; border-radius: 10px; margin-bottom: 15px; border: 2px solid gold;">æ±å®¶ï¼šãƒ„ãƒ¢ï¼ï¼</div>
    <div class="tile big-tile"><span class="tile-content pin-blue">â‘¥</span></div>
</div>

<div id="rainbow-flash"></div>

<script>
    const handSymbols = ["â‘ ","â‘ ","â‘ ","â‘¡","â‘¢","â‘£","â‘¤","â‘¥","â‘¦","â‘§","â‘¨","â‘¨","â‘¨"];
    const quotes = [
        "ãƒ„ãƒœãŒã‚ã‹ã‚“ãªã„ã§ã™",
        "æ‰¿çŸ¥ã™ã‚‹ã£ã¦ã„ãŸã‚ˆãªï¼ï¼Ÿ",
        "æ¬¡ã“ãä¹è“®å®ç‡ˆï¼ğŸ‘¶",
        "ã™ã”ã„ã§ã™ã‘ã©ã€ã‚¢ã‚¬ã£ã¦ã¯ãªã„ã§ã™ã‚ˆã­ï¼Ÿ",
        "ã‚ãƒ¼ãã‚‚ã¡ã„",
        "é€†ã«ã‚¢ã‚¬ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï¼Ÿ"
    ];
    const msg = document.getElementById('main-msg');
    const handDiv = document.getElementById('hand-display');
    const cutIn = document.getElementById('cut-in');

    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }

    function createTile(symbol) {
        const t = document.createElement('div');
        t.className = 'tile';
        const c = document.createElement('span');
        c.className = 'tile-content';
        c.innerText = symbol;
        if (symbol === "â‘ ") c.classList.add('pin-red');
        else if (symbol.match(/[â‘¡-â‘¨]/)) c.classList.add('pin-blue');
        else c.classList.add('character-black');
        t.appendChild(c);
        return t;
    }

    async function runScenario() {
        document.getElementById('start-btn').style.display = 'none';
        handDiv.innerHTML = '';
        
        for(let s of handSymbols) {
            handDiv.appendChild(createTile(s));
            vibrate(20);
            await wait(120);
        }

        await wait(1800);
        msg.innerText = "åŒ—å®¶ï¼šãƒªãƒ¼ãƒ..."; vibrate(50);
        await wait(1800);
        msg.innerText = "æ±å®¶ï¼šãƒªãƒ¼ãƒ..."; vibrate(50);
        await wait(2500);
        
        msg.style.color = "#ffff00";
        msg.innerText = "æ¿€ ç†±";
        gsap.fromTo(msg, {scale: 0.5, opacity: 0}, {scale: 1.5, opacity: 1, duration: 0.5, ease: "back.out"});
        vibrate([100, 50, 100]);
        await wait(1800);

        msg.style.color = "#ff0000";
        msg.innerText = "ä¹è“®å®ç‡ˆè´ç‰Œï¼ï¼";
        vibrate(400);
        await wait(2800);

        msg.style.color = "#fff";
        msg.innerText = "è¥¿å®¶ï¼šãƒ„ãƒ¢åˆ‡ã‚Š..."; await wait(1600);
        msg.innerText = "åŒ—å®¶ï¼šãƒ„ãƒ¢åˆ‡ã‚Š..."; await wait(1600);
        msg.innerText = "æ±å®¶ã®ãƒ„ãƒ¢ç•ª..."; await wait(2800);

        if (Math.random() < 0.9) {
            const q = quotes[Math.floor(Math.random() * quotes.length)];
            cutIn.style.display = 'block';
            gsap.to(cutIn, {scale: 1, duration: 0.4, ease: "back.out"});
            vibrate([300, 100, 300]);
            msg.innerText = "æ±å®¶ï¼šãƒ„ãƒ¢ï¼ï¼";
            await wait(2800);
            alert(`æ±å®¶ã€Œ${q}ã€\n\nã‚¢ã‚¬ãƒªç‰Œï¼šâ‘¥ç­’\n2000ã‚ªãƒ¼ãƒ«ã€‚çµ‚äº†ã€‚`);
            location.reload();
        } else {
            msg.innerText = "å¥‡è·¡ã®ãƒ„ãƒ¢ç•ª...ï¼";
            document.getElementById('slot-section').style.display = 'block';
            vibrate(600);
        }
    }

    async function handleTsumo() {
        document.getElementById('slot-section').style.display = 'none';
        const spinTile = document.getElementById('spin-tile');
        spinTile.classList.remove('spinning');
        await wait(1200);
        
        const sub = Math.random();
        if (sub < 0.989) {
            spinTile.innerHTML = '<span class="tile-content character-black">è¥¿</span>';
            msg.innerText = "ãƒã‚ºãƒ¬ã€‚";
            await wait(1800);
            alert("è¥¿å®¶ï¼šãƒ­ãƒ³ã€‚1000ç‚¹ã€‚\næ¬¡ã“ãä¹è“®å®ç‡ˆ...ï¼");
            location.reload();
        } else if (sub < 0.999) {
            spinTile.innerHTML = '<span class="tile-content pin-blue">â‘¢</span>';
            msg.innerText = "ãƒ„ãƒ¢ï¼";
            await wait(1800);
            alert("æ¸…ä¸€è‰²\nã€Œãã£ã¡ã˜ã‚ƒãªã„ã‚“ã ã‚ˆãªã...ã€");
            location.reload();
        } else {
            document.getElementById('rainbow-flash').style.display = 'block';
            spinTile.innerHTML = '<span class="tile-content pin-blue">â‘¥</span>';
            msg.innerText = "ä¹ è“® å® ç‡ˆ ï¼ï¼";
            vibrate([500, 100, 500, 100, 1000]);
            await wait(4500);
            alert("ä¼èª¬ã®ä¹è“®å®ç‡ˆï¼ãŠã‚ã§ã¨ã†ï¼ï¼");
            location.reload();
        }
    }
</script>
</body>
</html>
