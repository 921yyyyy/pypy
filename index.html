<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¡ã“ãä¹è“®å®ç‡ˆ -æ¥µ-</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --bg-green: #1a4a1a; --tile-white: linear-gradient(145deg, #ffffff, #e6e6e6); }
        body { margin: 0; background: radial-gradient(circle, #2a5a2a 0%, #0a2a0a 100%); color: #fff; font-family: "Hiragino Mincho ProN", serif; overflow: hidden; touch-action: manipulation; }
        #game-ui { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 20px; box-sizing: border-box; }

        /* ãƒªã‚¢ãƒ«ãªéº»é›€ç‰Œ */
        .tile {
            width: 45px; height: 65px; background: var(--tile-white); border-radius: 4px;
            box-shadow: 0 4px 0 #bbb, 0 6px 10px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: bold; color: #0044ff; position: relative;
        }
        .tile::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: linear-gradient(white, rgba(255,255,255,0)); border-radius: 4px 4px 0 0; opacity: 0.5; }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¼”å‡º */
        #main-msg { font-size: 2.2rem; text-align: center; font-weight: bold; text-shadow: 0 0 15px #ff0000; min-height: 80px; }

        /* ãƒœã‚¿ãƒ³ */
        .btn-pachinko {
            padding: 15px 60px; font-size: 1.8rem; border-radius: 50px; border: 4px solid #ffd700;
            background: linear-gradient(to bottom, #ff4444, #880000); color: white;
            box-shadow: 0 0 20px rgba(255,0,0,0.6), inset 0 0 10px rgba(255,255,255,0.5);
            cursor: pointer; transition: transform 0.1s;
        }
        .btn-pachinko:active { transform: scale(0.95); }

        /* ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡º */
        #cut-in {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            z-index: 50; display: none; text-align: center;
        }
        .big-tile { width: 150px; height: 210px; font-size: 6rem; border-radius: 12px; box-shadow: 0 0 50px rgba(255,255,0,0.8); }

        /* ã‚¹ãƒ­ãƒƒãƒˆ */
        #slot-section { display: none; text-align: center; }
        .slot-display { display: flex; gap: 15px; margin: 30px 0; }
        .spinning { animation: blur-spin 0.05s infinite; }
        @keyframes blur-spin { 0% { filter: blur(0px); transform: translateY(-2px); } 100% { filter: blur(4px); transform: translateY(2px); } }

        /* ä¹è“®æ¼”å‡º */
        #rainbow-flash { position: fixed; inset: 0; display: none; pointer-events: none; z-index: 100; animation: rainbow 0.2s infinite; opacity: 0.3; }
        @keyframes rainbow { 0% { background: red; } 20% { background: yellow; } 40% { background: green; } 60% { background: cyan; } 80% { background: blue; } 100% { background: magenta; } }
    </style>
</head>
<body>

<div id="game-ui">
    <div id="main-msg">æ¬¡ã“ãä¹è“®å®ç‡ˆ</div>
    
    <div id="hand-display" style="display: flex; gap: 4px; flex-wrap: wrap; justify-content: center;"></div>

    <div id="action-area">
        <button id="start-btn" class="btn-pachinko" onclick="runScenario()">æ‰“ ã¤</button>
    </div>

    <div id="slot-section">
        <div class="slot-display">
            <div class="tile big-tile">â‘£</div>
            <div id="spin-tile" class="tile big-tile spinning">?</div>
            <div class="tile big-tile">â‘¤</div>
        </div>
        <p style="color:#ffd700; font-weight:bold;">é€£æ‰“ã—ã‚ï¼ï¼ï¼</p>
        <button class="btn-pachinko" onclick="handleTsumo()">ãƒ„ãƒ¢ï¼ï¼</button>
    </div>
</div>

<div id="cut-in">
    <div id="cut-in-label" style="font-size: 2rem; color: #ff0000; font-weight:bold; background: rgba(0,0,0,0.7); margin-bottom: 10px;">æ±å®¶ï¼šãƒ„ãƒ¢ï¼ï¼</div>
    <div id="cut-in-tile" class="tile big-tile">â‘¥</div>
</div>

<div id="rainbow-flash"></div>

<script>
    const hand = ["â‘ ","â‘ ","â‘ ","â‘¡","â‘¢","â‘£","â‘¤","â‘¥","â‘¦","â‘§","â‘¨","â‘¨","â‘¨"];
    const quotes = [
        "ãƒ„ãƒœãŒã‚ã‹ã‚“ãªã„ã§ã™",
        "æ‰¿çŸ¥ã™ã‚‹ã£ã¦ã„ãŸã‚ˆãªï¼ï¼Ÿ",
        "æ¬¡ã“ãä¹è“®å®ç‡ˆï¼ğŸ‘¶",
        "ã™ã”ã„ã§ã™ã‘ã©ã€ã‚¢ã‚¬ã£ã¦ã¯ãªã„ã§ã™ã‚ˆã­ï¼Ÿ",
        "ã‚ãƒ¼ãã‚‚ã¡ã„",
        "é€†ã«ã‚¢ã‚¬ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï¼Ÿ"
    ];
    const msg = document.getElementById('main-msg');
    const handDiv = document.getElementById('hand-display');
    const cutIn = document.getElementById('cut-in');

    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }

    async function runScenario() {
        document.getElementById('start-btn').style.display = 'none';
        handDiv.innerHTML = '';
        
        for(let t of hand) {
            const div = document.createElement('div');
            div.className = 'tile'; div.innerText = t;
            handDiv.appendChild(div);
            await wait(100);
        }

        await wait(1500);
        msg.innerText = "åŒ—å®¶ï¼šãƒªãƒ¼ãƒ..."; vibrate(50);
        await wait(1500);
        msg.innerText = "æ±å®¶ï¼šãƒªãƒ¼ãƒ..."; vibrate(50);
        await wait(2000);
        
        msg.style.color = "#ffff00";
        msg.innerText = "æ¿€ ç†±";
        gsap.fromTo(msg, {scale: 0.5}, {scale: 1.5, duration: 0.5, ease: "back.out"});
        vibrate([100, 50, 100]);
        await wait(1500);

        msg.style.color = "#ff0000";
        msg.innerText = "ä¹è“®å®ç‡ˆè´ç‰Œï¼ï¼";
        vibrate(300);
        await wait(2500);

        msg.style.color = "#fff";
        msg.innerText = "è¥¿å®¶ï¼šãƒ„ãƒ¢åˆ‡ã‚Š..."; await wait(1200);
        msg.innerText = "åŒ—å®¶ï¼šãƒ„ãƒ¢åˆ‡ã‚Š..."; await wait(1200);
        msg.innerText = "æ±å®¶ã®ãƒ„ãƒ¢ç•ª..."; await wait(2000);

        const isLucky = Math.random() < 0.1;

        if (!isLucky) {
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            cutIn.style.display = 'block';
            gsap.to(cutIn, {scale: 1, duration: 0.3, ease: "back.out"});
            vibrate([200, 100, 200]);
            msg.innerText = "æ±å®¶ï¼šãƒ„ãƒ¢ï¼ï¼";
            await wait(2500);
            alert(`æ±å®¶ã€Œ${randomQuote}ã€\n\nã‚¢ã‚¬ãƒªç‰Œï¼šâ‘¥ç­’\n2000ã‚ªãƒ¼ãƒ«ã€‚çµ‚äº†ã€‚`);
            location.reload();
        } else {
            msg.innerText = "å¥‡è·¡ã®ãƒ„ãƒ¢ç•ª...ï¼";
            document.getElementById('slot-section').style.display = 'block';
            vibrate(500);
        }
    }

    async function handleTsumo() {
        document.getElementById('slot-section').style.display = 'none';
        const spinTile = document.getElementById('spin-tile');
        spinTile.classList.remove('spinning');
        await wait(1000);
        
        const sub = Math.random();
        if (sub < 0.989) {
            spinTile.innerText = "è¥¿";
            msg.innerText = "ãƒã‚ºãƒ¬ã€‚";
            await wait(1500);
            alert("è¥¿å®¶ï¼šãƒ­ãƒ³ã€‚1000ç‚¹ã€‚\næ¬¡ã“ãä¹è“®å®ç‡ˆ...ï¼");
            location.reload();
        } else if (sub < 0.999) {
            spinTile.innerText = "â‘¢";
            msg.innerText = "ãƒ„ãƒ¢ï¼";
            await wait(1500);
            alert("æ¸…ä¸€è‰²ãƒ»å¹³å’Œã€‚2000-4000ã€‚\nã€Œãã£ã¡ã˜ã‚ƒãªã„ã‚“ã ã‚ˆãªã...ã€");
            location.reload();
        } else {
            document.getElementById('rainbow-flash').style.display = 'block';
            spinTile.innerText = "â‘¥";
            msg.innerText = "ä¹ è“® å® ç‡ˆ ï¼ï¼";
            vibrate([500, 100, 500, 100, 1000]);
            await wait(4000);
            alert("ä¼èª¬ã®ä¹è“®å®ç‡ˆï¼ãŠã‚ã§ã¨ã†ï¼ï¼");
            location.reload();
        }
    }
</script>
</body>
</html>
